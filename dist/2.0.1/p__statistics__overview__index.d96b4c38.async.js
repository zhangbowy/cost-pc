(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[62],{M6K0:function(e,t,a){"use strict";a.r(t);a("lUTK");var n=a("BvKs"),r=a("d6i3"),s=a.n(r),i=a("1l/V"),c=a.n(i),o=a("eHn4"),l=a.n(o),u=(a("Awhp"),a("KrTs")),p=a("p0pE"),d=a.n(p),m=a("gWZ8"),f=a.n(m),h=a("2Taf"),y=a.n(h),v=a("vZ4D"),g=a.n(v),b=a("rlhR"),E=a.n(b),S=a("MhPg"),w=a.n(S),x=a("l4Ni"),k=a.n(x),I=a("ujKo"),L=a.n(I),j=a("q1tI"),C=a.n(j),N=a("/MKj"),T=a("2g+w"),R=a("RsOY"),P=a.n(R),O=(a("g9YV"),a("wCAj")),K=a("jehZ"),A=a.n(K),D=(a("qVdP"),a("jsC+")),Q=(a("+L6B"),a("2/Rp")),q=(a("Pwec"),a("CtXQ")),G=(a("miYZ"),a("tsqr")),z=(a("17x9"),a("7rtZ")),V=a("JOxK"),_=a.n(V),M=a("rB7f"),J=a.n(M),W=a("z0WU"),Y=a("jwRn"),Z=a("ydnR");function B(e){var t=F();return function(){var a,n=L()(e);if(t){var r=L()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return k()(this,a)}}function F(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var $,U,H,X=Z["r"].APP_API,ee=function(e){w()(a,e);var t=B(a);function a(){var e;y()(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),e.state={selectedRows:[],selectedRowKeys:[]},e.onSelectAll=function(t,a,n){var r=W["o"].onSelectAll(e.state,t,n),s=r.selectedRows,i=r.selectedRowKeys,c=0;s.forEach(function(e){c+=e.submitSum}),e.setState({selectedRows:s,selectedRowKeys:i,sumAmount:c})},e.onSelect=function(t,a){var n=W["o"].onSelect(e.state,t,a),r=n.selectedRows,s=n.selectedRowKeys,i=0;r.forEach(function(e){i+=e.submitSum}),e.setState({selectedRows:r,selectedRowKeys:s,sumAmount:i})},e.handleTableChange=function(t,a,n){var r=d()({},a);if(r.status&&Object.assign(r,{status:a.status[0]||""}),t){var s=t.current,i=t.pageSize;Object.assign(r,{pageNo:s,pageSize:i})}if(n){var c="";"ascend"===n.order?c=1:"descend"===n.order&&(c=2),Object.assign(r,{sortType:c})}e.props.onQuery(r)},e.handleCancel=function(){e.setState({selectedRows:[],selectedRowKeys:[]})},e.print=function(){var t=e.state.selectedRows;if(t.length>10)G["a"].error("\u6700\u591a\u652f\u6301\u6253\u5370\u5341\u6761\u6570\u636e");else if(0!==t.length){var a=t.map(function(e){return e.invoiceSubmitId}),n=Array.from(new Set(a)),r=n.join(",");Object(Y["f"])("".concat(X,"/cost/pdf/batch/submit?token=").concat(localStorage.getItem("token"),"&ids=").concat(r))}else G["a"].error("\u8bf7\u9009\u62e9\u4e00\u6761\u6570\u636e\u6253\u5370")},e.customExpandIcon=function(e){return e.record.children.length>0?e.expanded?C.a.createElement("a",{style:{marginRight:8},className:"c-black-65",onClick:function(t){e.onExpand(e.record,t)}},C.a.createElement("i",{className:"table-minus"})):C.a.createElement("a",{style:{marginRight:8},onClick:function(t){e.onExpand(e.record,t)},className:"c-black-65"},C.a.createElement("i",{className:"table-plus"})):C.a.createElement("span",null)},e.onExport=function(t){var a=e.props.onExports,n=e.state.selectedRowKeys;if(console.log("TempTable -> onExport -> selectedRowKeys",t),0!==n.length||"1"!==t){var r={};1===Number(t)&&(r={ids:n}),a(r,t)}else G["a"].error("\u8bf7\u9009\u62e9\u8981\u5bfc\u51fa\u7684\u6570\u636e")},e.onInit=function(){e.setState({selectedRowKeys:[],selectedRows:[]})},e}return g()(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.list,r=t.columns,s=t.tableProps,i=t.pagination,c=t.hisRecord,o=t.currentType,l=t.loading,u=t.isNoRole,p=t.expandIds,m=this.state,h=m.selectedRowKeys,y=m.sumAmount,v={type:"checkbox",selectedRowKeys:h,onSelect:this.onSelect,onSelectAll:this.onSelectAll,columnWidth:"24px"};return C.a.createElement(C.a.Fragment,null,C.a.createElement("div",{className:"content-dt",style:{height:"auto"}},C.a.createElement("div",{className:"cnt-header"},C.a.createElement("div",{className:"head_lf",style:{display:"flex"}},C.a.createElement(D["a"],{overlay:C.a.createElement(n["a"],{onClick:function(t){return e.onExport(t.key)}},!o&&C.a.createElement(n["a"].Item,{key:"1"},C.a.createElement("span",{className:"pd-20-9 c-black-65"},"\u5bfc\u51fa\u9009\u4e2d\uff08",h.length,"\uff09")),C.a.createElement(n["a"].Item,{key:"2"},C.a.createElement("span",{className:"pd-20-9 c-black-65"},"\u5bfc\u51fa\u9ad8\u7ea7\u641c\u7d22\u7ed3\u679c")),C.a.createElement(n["a"].Item,{key:"3"},C.a.createElement("span",{className:"pd-20-9 c-black-65"},"\u5bfc\u51fa\u5168\u90e8"))),overlayClassName:J.a.menuBtn},C.a.createElement(Q["a"],null,"\u5bfc\u51fa ",C.a.createElement(q["a"],{type:"down"}))),!o&&C.a.createElement(Q["a"],{className:"m-l-8",onClick:function(){return e.print()}},"\u6253\u5370"))),0===o&&C.a.createElement("div",{className:J.a.message},C.a.createElement("span",{className:"fs-14 c-black-65"},h.length?"\u5df2\u9009".concat(h.length):"\u5171".concat(c.total),"\u6761\u8bb0\u5f55\uff0c\u5408\u8ba1"),C.a.createElement("span",{className:"fs-16 c-black-85 fw-500"},"\xa5",h.length?y/100:c.sum/100)),0===o||4===o?C.a.createElement(O["a"],A()({dataSource:a,columns:r,loading:l},s,{rowSelection:0===o?v:null,onChange:this.handleTableChange,pagination:d()({},i,{size:"small",showTotal:function(){return"\u5171".concat(i.total,"\u6761\u6570\u636e")},showSizeChanger:!0,showQuickJumper:!0})})):C.a.createElement(O["a"],A()({dataSource:a,columns:r,loading:l},s,{rowSelection:0===o?v:null,onChange:this.handleTableChange,defaultExpandAllRows:!0,expandedRowKeys:p,onExpand:function(t,a){e.props.onChangeDatas("expandIds",t?[].concat(f()(p),[a.id]):p.filter(function(e){return e!==a.id}))},expandIcon:function(t){return e.customExpandIcon(t)},locale:{emptyText:u?C.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},C.a.createElement("img",{src:_.a,alt:"\u6682\u65e0\u6570\u636e",style:{width:"200px"}}),C.a.createElement("span",null,"\u6682\u65e0\u67e5\u770b\u6743\u9650\uff0c",C.a.createElement(z["a"],null,C.a.createElement("a",null,"\u70b9\u51fb\u67e5\u770b\u539f\u56e0 >")))):"\u6682\u65e0\u6570\u636e"},pagination:!1}))))}}]),a}(j["PureComponent"]),te=ee,ae=a("YmKb"),ne=a("mKGG"),re=a("l2vx"),se=a("G8x6"),ie=a("l59Y"),ce=a("zjCJ");function oe(e){var t=le();return function(){var a,n=L()(e);if(t){var r=L()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return k()(this,a)}}function le(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var ue=[{key:"0",name:"\u652f\u51fa\u660e\u7ec6",url:"statistics_costDetail"},{key:"1",name:"\u90e8\u95e8\u652f\u51fa",url:"statistics_department"},{key:"2",name:"\u7c7b\u522b\u652f\u51fa",url:"statistics_classify"},{key:"3",name:"\u9879\u76ee\u652f\u51fa",url:"statistics_project"},{key:"4",name:"\u5458\u5de5\u652f\u51fa",url:"statistics_people"},{key:"5",name:"\u4f9b\u5e94\u5546\u652f\u51fa",url:"statistics_supplier"}],pe={2:{name:"\u5f85\u53d1\u653e"},3:{name:"\u5df2\u53d1\u653e"}},de=($=Object(N["c"])(function(e){var t=e.overview,a=e.loading,n=e.global,r=e.costGlobal;return{loading:a.effects["overview/detail"]||a.effects["overview/dept"]||a.effects["overview/classify"]||a.effects["overview/project"]||a.effects["overview/supplier"]||a.effects["overview/people"]||!1,chartLoading:a.effects["overview/deptDetail"]||!1,list:t.list,sum:t.sum,query:t.query,total:t.total,queryPage:t.queryPage,detailList:t.detailList,chartList:t.chartList,pieChartVos:t.pieChartVos,listQuery:t.listQuery,listTotal:t.listTotal,subSum:t.subSum,costCategoryList:n.costCategoryList,invoiceList:n.invoiceList,projectList:r.projectList,supplierList:n.supplierList,roleStatics:r.roleStatics}}),$((H=function(e){w()(a,e);var t=oe(a);function a(e){var n;return y()(this,a),n=t.call(this,e),n.onInits=function(e){var t=n.props,a=t.detailList,r=t.listQuery,s=t.listTotal,i=t.pieChartVos,c=t.chartLoading,o=ae["default"][e],l=o.columns,p=o.query,m=o.chartName,h=o.searchList,y=o.type,v=f()(l),g=localStorage.getItem("linkStatus");localStorage.removeItem("linkStatus");var b=f()(h);"undefined"!==g&&g&&(b=h.map(function(e){return"statusList"===e.key?d()({},e,{value:{statusList:[g]},valueStr:pe[g]&&pe[g].name}):d()({},e)}));var S=E()(n);0!==Number(e)?(v=P()(v,{$splice:[[1,0,{title:"\u91d1\u989d\uff08\u5143\uff09",dataIndex:"submitSumAll",render:function(t,o){return C.a.createElement(re["a"],{title:"".concat(o[m],"\u652f\u51fa\u7edf\u8ba1"),detailList:a,onQuery:function(e){return S.inVoiceQuery(e)},query:r,total:s,id:o[y]||o.userId||"-1",projectType:o.projectType,pageDetail:S.pageDetail,chartList:i,onChart:function(e){return n.onChart(e,Number(y))},currentType:Number(e),loading:c},"dept"===p?C.a.createElement("a",null,o.submitSumAll?(o.submitSumAll/100).toFixed(2):0,o.submitSum&&-1!==o.id&&o.children&&o.children.length?"\uff08\u672c\u90e8".concat((o.submitSum/100).toFixed(2),"\uff09"):""):C.a.createElement("a",null,"\xa5",(o.submitSumAll/100).toFixed(2)))},className:"moneyCol",width:"dept"===p?160:100}]]}),1!==Number(e)&&2!==Number(e)||(v=P()(v,{$splice:[[v.length,0,{title:"\u64cd\u4f5c",dataIndex:"ope",width:150,render:function(e,t){return C.a.createElement(ne["a"],{data:t,onChart:n.onChart,chartName:m,type:p,changeMoney:100,getTime:n.onGetTime},C.a.createElement("a",null,"\u67e5\u770b\u8d8b\u52bf\u56fe"))},fixed:"right"}]]}))):v=P()(v,{$splice:[[v.length,0,{title:"\u5355\u636e\u72b6\u6001",dataIndex:"status",render:function(e,t){var a=t.status;return C.a.createElement("span",null,C.a.createElement(u["a"],{color:"-"===Object(Z["y"])("".concat(a),Z["C"])?"rgba(255, 148, 62, 1)":Object(Z["y"])("".concat(a),Z["C"]),text:t.statusStr||Object(Z["z"])(t.status,Z["C"])}))},width:110,fixed:"right",filters:[{text:"\u5df2\u53d1\u653e",value:"3"},{text:"\u5f85\u53d1\u653e",value:"2"}]}],[v.length+1,0,{title:"\u64cd\u4f5c",dataIndex:"ope",render:function(e,t){return C.a.createElement("span",null,C.a.createElement(ie["a"],{id:t.invoiceSubmitId,templateType:t.templateType},C.a.createElement("a",null,"\u67e5\u770b")))},width:80,fixed:"right",className:"fixCenter"}]]}),n.setState({columns:v,current:e},function(){n.search(b,function(){var t={};0!==Number(e)&&4!==Number(e)||Object.assign(t,{pageNo:1,pageSize:10}),b.forEach(function(e){e.value&&Object.assign(t,d()({},e.value))}),n.onQuery(d()({},t))})})},n.search=function(e,t){var a=n.props.dispatch,r=E()(n),s=["projectList","supplierList","costList","invoiceList"],i=s.map(function(e){return a({type:"projectList"===e?"costGlobal/".concat(e):"global/".concat(e),payload:{}})});Promise.all(i).then(function(){var a=r.props,s=a.costCategoryList,i=a.invoiceList,c=a.projectList,o=a.supplierList,u=[s,c,i],p=["categoryIds","projectIds","invoiceTemplateIds","supplierIds"],m={},f=u.map(function(e,t){return Object(T["a"])({rootId:0,pId:"parentId",name:0===t?"costName":"name",tName:"title",tId:"value"},e)});f.push(o),f.forEach(function(e,t){Object.assign(m,l()({},p[t],e))});var h=[];e.forEach(function(e){p.includes(e.key)?h.push(d()({},e,{options:m[e.key],fileName:{key:"id",name:"name"}})):h.push(d()({},e))}),n.setState({searchList:h},function(){t&&t()})})},n.onQuery=function(e,t){var a=n.state,r=a.current,s=a.searchList;s.forEach(function(t){t.value&&Object.assign(e,d()({},t.value))}),n.props.dispatch({type:"overview/".concat(ae["default"][r].query),payload:e}).then(function(){t&&t();var e=n.props,a=e.list,r=e.queryPage,s=e.total;n.setState({list:a,queryPage:r,total:s,expandIds:a.map(function(e){return e.id})})})},n.inVoiceQuery=function(e){var t=n.state.current;if(Object.assign(e,d()({},n.onGetSearch(),{currentType:t})),e.id){var a=ae["default"][t].type;Object.assign(e,l()({},a,e.id)),delete e.id}return new Promise(function(t){n.props.dispatch({type:"overview/deptDetail",payload:e}).then(function(){var e=n.props,a=e.detailList,r=e.pieChartVos,s=e.listQuery,i=e.listTotal,c=e.subSum;t({detailList:a,pieChartVos:r,listQuery:s,listTotal:i,subSum:c,tableLoading:!1,chartLoading:!1})})})},n.pageDetail=function(e){var t=n.state.current;if(Object.assign(e,d()({},n.onGetSearch(),{currentType:t})),e.id){var a=ae["default"][t].type;Object.assign(e,l()({},a,e.id)),delete e.id}return new Promise(function(t){n.props.dispatch({type:"overview/deptDetail",payload:e}).then(function(){var e=n.props,a=e.detailList,r=e.listQuery;t({detailList:a,listQuery:r,tableLoading:!1})})})},n.onChart=function(e,t){return Object.assign(e,d()({},n.onGetSearch())),5===Number(t)&&Object.assign(e,{chartTypes:"supplier"}),new Promise(function(t){n.props.dispatch({type:"overview/chart",payload:e}).then(function(){var e=n.props.chartList;t(e)})})},n.handleClick=function(e){var t=n.props.loading;t||(n.childRef&&n.childRef.onInit&&n.childRef.onInit(),n.setState({list:[]}),n.onInits(e.key))},n.onProject=function(e){return new Promise(function(t){n.props.dispatch({type:"costGlobal/projectList",payload:e}).then(function(){var e=n.props.projectList,a=Object(T["a"])({rootId:0,pId:"parentId",name:"name",tName:"title",tId:"value"},e);t({lists:a,projectList:e})})})},n.onGetTime=function(){var e=n.state.searchList,t=e.filter(function(e){return"timeC"===e.id});if(t&&t.length>0){var a=t[0].value;return{dateType:a.dateType,startTime:a.startTime||Object(ce["a"])().startTime}}},n.onChangeSearch=function(){var e=c()(s.a.mark(function e(t){var a,r,i,c,o,u,p,m,h,y,v,g,b;return s.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a=f()(t),r=n.state.searchList,i=t.findIndex(function(e){return"projectIds"===e.linkKey}),c=t.findIndex(function(e){return"timeC"===e.key}),!(i>-1)){e.next=17;break}if(o=r[i].key,u=r[i].value||{},p=t[i].value||{},p[o]===u[o]){e.next=17;break}return m=t.findIndex(function(e){return"projectIds"===e.key}),e.next=12,n.onProject(d()({},p));case 12:h=e.sent,y=h.lists,v=h.projectList,g=v.filter(function(e){return 1===e.type}),a=P()(a,{$splice:[[m,1,d()({},t[m],{options:y||[],value:0!==p[o]?l()({},t[m].key,g.map(function(e){return e.id})):null,valueStr:null})]]});case 17:c&&c.length&&(b=c[0].value.dateType,-1===b&&n.setState({dateType:-1})),n.setState({searchList:a},function(){n.onQuery({pageNo:1,pageSize:10})});case 19:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.onGetSearch=function(){var e={},t=n.state.searchList;return t.forEach(function(t){t.value&&Object.assign(e,d()({},t.value))}),e},n.onExport=function(e,t){var a=n.state.current,r={currentType:a};2===Number(t)?r=d()({},n.onGetSearch(),{currentType:a}):1===Number(t)?r=d()({},e,{currentType:a}):3===Number(t)&&(r={isAll:!0,currentType:a}),n.props.dispatch({type:"overview/export",payload:d()({},r)})},n.onChangeData=function(e,t){n.setState(l()({},e,t))},n.childRef=null,n.state={current:"0",columns:ae["default"][0].columns,searchList:ae["default"][0].searchList,list:[],menus:ue,queryPage:{pageNo:1,pageSize:10},total:0,expandIds:[],dateType:0},n}return g()(a,[{key:"componentDidMount",value:function(){var e=this;this.props.dispatch({type:"costGlobal/roleStatics",payload:{id:"470538850289750017"}}).then(function(){var t=e.props.roleStatics,a=t.map(function(e){return e.url}),n=[];ue.forEach(function(e){a.includes(e.url)&&n.push(e)}),e.setState({menus:n});var r=localStorage.getItem("linkType");localStorage.removeItem("linkType"),r||0===r?e.onInits(r):e.onInits("0")})}},{key:"render",value:function(){var e=this,t=this.state,a=t.current,r=t.columns,s=t.searchList,i=t.list,c=t.menus,o=t.queryPage,l=t.total,u=t.expandIds,p=t.dateType,d=ae["default"][a].tableProps,m=this.props,f=m.sum,h=m.loading;return C.a.createElement("div",{style:{minWidth:"1000px"}},C.a.createElement("div",{style:{background:"#fff",paddingTop:"16px"}},C.a.createElement("p",{className:"m-l-32 m-b-8 c-black-85 fs-20",style:{fontWeight:"bold"}},"\u652f\u51fa\u5206\u6790\u8868"),C.a.createElement(n["a"],{onClick:this.handleClick,mode:"horizontal",selectedKeys:[a],className:"m-l-32 titleMenu"},c.map(function(e){return C.a.createElement(n["a"].Item,{key:e.key},e.name)}))),C.a.createElement(se["a"],{list:s||[],onChange:this.onChangeSearch}),C.a.createElement(te,{ref:function(t){e.childRef=t},list:i,loading:h,columns:r,currentType:Number(a),onQuery:this.onQuery,onExports:this.onExport,dateType:p,expandIds:u,hisRecord:{total:l,sum:f},onChangeDatas:this.onChangeData,tableProps:d,pagination:(0===Number(a)||4===Number(a))&&{current:o.pageNo,total:l}}))}}]),a}(j["Component"]),U=H))||U);t["default"]=de}}]);