(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[17],{"4SE/":function(e,t,a){"use strict";a.r(t);a("+L6B");var n,r,i,l=a("2/Rp"),s=(a("lUTK"),a("BvKs")),c=(a("h7lp"),a("bf48")),o=a("eHn4"),d=a.n(o),u=a("gWZ8"),f=a.n(u),p=a("p0pE"),h=a.n(p),m=a("2Taf"),y=a.n(m),v=a("vZ4D"),g=a.n(v),I=a("MhPg"),k=a.n(I),b=a("l4Ni"),E=a.n(b),x=a("ujKo"),C=a.n(x),R=a("q1tI"),S=a.n(R),L=a("/MKj"),N=a("TSYQ"),w=a.n(N),F=a("2g+w"),D=a("KtMI"),j=a("0AXd"),O=a("XohA"),_=a("jehZ"),P=a.n(_),A=(a("BoS7"),a("Sdc0")),W=(a("Pwec"),a("CtXQ")),M=(a("6UJt"),a("DFOY")),T=(a("5NDa"),a("5rEg")),V=(a("y8nQ"),a("Vl3Y")),K=a("27j4"),G=a.n(K),B=a("ydnR"),U=a("boNk"),Y=a.n(U);function q(e){var t=z();return function(){var a,n=C()(e);if(t){var r=C()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return E()(this,a)}}function z(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var H={costName:"\u540d\u79f0",parentId:"\u6240\u5c5e\u5206\u7ec4",note:"\u63cf\u8ff0",icon:"\u56fe\u6807",status:"\u542f\u7528"},Q=(n=V["a"].create(),n((i=function(e){k()(a,e);var t=q(a);function a(e){var n;return y()(this,a),n=t.call(this,e),n.onChangeIcon=function(e){n.setState({active:e})},n.filter=function(e,t){return t.some(function(t){return t.label.toLowerCase().indexOf(e.toLowerCase())>-1})},n.getFormItems=function(){var e=n.props.form,t=n.state.active,a={icon:t};return e.validateFieldsAndScroll(function(e,t){e?a=null:Object.assign(a,h()({},t))}),a},n.state={active:e.data&&e.data.icon||"morenleibietu1",data:e.data||{}},n}return g()(a,[{key:"componentDidUpdate",value:function(e){e.data!==this.props.data&&this.setState({data:this.props.data,active:this.props.data&&this.props.data.icon||"morenleibietu1"})}},{key:"onRest",value:function(){this.setState({active:"morenleibietu1"}),this.props.form.resetFields()}},{key:"render",value:function(){var e=this,t=this.props,a=t.form.getFieldDecorator,n=t.list,r=t.title,i=n.filter(function(e){return 0===Number(e.type)}),l=Object(F["a"])({rootId:0,pId:"parentId",name:"costName",tName:"costName"},i),s=this.state,c=s.active,o=s.data,d={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}};return S.a.createElement("div",{style:{width:"100%",paddingTop:"24px",overflowY:"scroll"}},S.a.createElement(V["a"],P()({},d,{className:"formItem",style:{width:"450px"}}),S.a.createElement(V["a"].Item,{label:H.costName},a("costName",{initialValue:o&&o.costName,rules:[{required:!0,message:"\u8bf7\u8f93\u5165"}]})(S.a.createElement(T["a"],{placeholder:"\u8bf7\u8f93\u5165"}))),S.a.createElement(V["a"].Item,{label:H.parentId},a("parentId",{initialValue:o&&o.parentId||""})(S.a.createElement(M["a"],{options:l,placeholder:"\u8bf7\u9009\u62e9",fieldNames:{label:"costName",value:"id"},disabled:"edit"===r,changeOnSelect:!0,showSearch:this.filter,getPopupContainer:function(e){return e.parentNode}}))),S.a.createElement(V["a"].Item,{label:H.note},a("note",{initialValue:o&&o.note,rules:[{max:50,message:"\u4e0d\u80fd\u8d85\u8fc750\u5b57"}]})(S.a.createElement(G.a,{max:50,placeholder:"\u8bf7\u8f93\u5165"}))),S.a.createElement(V["a"].Item,{label:H.icon},S.a.createElement("div",{className:Y.a.iconMap},B["m"].map(function(t){return S.a.createElement("div",{className:t.key===c?w()(Y.a.iconList,Y.a.activeIcon):Y.a.iconList,key:t.key,onClick:function(){return e.onChangeIcon(t.key)}},S.a.createElement("i",{className:w()("iconfont",t.value),style:{color:t.color}}),c===t.key&&S.a.createElement("div",{className:Y.a.checked},S.a.createElement(W["a"],{type:"check",style:{color:"#fff"},className:"fs-12"})))}))),S.a.createElement(V["a"].Item,{label:H.status},a("status",{initialValue:!(!o||void 0!==o.status)||o.status,valuePropName:"checked"})(S.a.createElement(A["a"],null)))))}}]),a}(R["Component"]),r=i))||r),X=Q,Z=(a("sRBo"),a("kaz8")),J=a("eW2x"),$=a.n(J);function ee(e){var t=te();return function(){var a,n=C()(e);if(t){var r=C()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return E()(this,a)}}function te(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var ae,ne,re,ie=[{key:"user",value:"\u627f\u62c5\u4eba",disabled:!0,checked:[1,!1],children:[{label:"\u542f\u7528\uff08\u4e0d\u53ef\u4fee\u6539\uff09",value:1,name:"status"},{label:"\u5fc5\u586b\uff08\u4e0d\u53ef\u4fee\u6539\uff09",value:!0,name:"isWrite"}]},{key:"dept",value:"\u627f\u62c5\u90e8\u95e8",disabled:!0,checked:[1,!0],children:[{label:"\u542f\u7528\uff08\u4e0d\u53ef\u4fee\u6539\uff09",value:1,name:"status"},{label:"\u5fc5\u586b\uff08\u4e0d\u53ef\u4fee\u6539\uff09",value:!0,name:"isWrite"}]}],le=function(e){k()(a,e);var t=ee(a);function a(){var e;y()(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),e.onChecks=function(t,a){var n=e.props.shareField,r=[];n.forEach(function(e){var n={};"status"===a?(console.log(t.target.value),n[a]=t.target.checked?1:0):"isWrite"===a&&(n[a]=t.target.checked),"project"===e.field?r.push(h()({},e,n)):r.push(e)}),console.log("Share -> onChecks -> newArr",r),e.props.onChangeData("shareField",r)},e}return g()(a,[{key:"render",value:function(){var e=this,t=this.props.shareField,a=t.filter(function(e){return"project"===e.field}),n=t.findIndex(function(e){return"project"===e.field});return 3!==ie.length?ie.push({key:"project",value:"\u9879\u76ee",checked:[a[0].status?1:0,a[0].isWrite],children:[{label:"\u542f\u7528",value:1,name:"status"},{label:"\u5fc5\u586b",value:!0,name:"isWrite"}]}):ie.splice(n,1,{key:"project",value:"\u9879\u76ee",checked:[a[0].status?1:0,a[0].isWrite],children:[{label:"\u542f\u7528",value:1,name:"status"},{label:"\u5fc5\u586b",value:!0,name:"isWrite"}]}),S.a.createElement("div",{style:{marginTop:"32px"}},ie.map(function(t){return S.a.createElement("div",{key:t.key,style:{display:"flex"}},S.a.createElement("p",{className:$.a.checkT},t.value,"\uff1a"),S.a.createElement(Z["a"].Group,{defaultValue:t.checked,disabled:t.disabled},t.children.map(function(t){return S.a.createElement(Z["a"],{key:t.value,value:t.value,onClick:function(a){return e.onChecks(a,t.name)},classlabel:"m-r-30"},t.label)})))}))}}]),a}(R["Component"]),se=le,ce=a("z0WU"),oe=a("PtP1");function de(e){var t=ue();return function(){var a,n=C()(e);if(t){var r=C()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return E()(this,a)}}function ue(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var fe=[{key:"one",value:"\u57fa\u7840\u8bbe\u7f6e"},{key:"two",value:"\u5b57\u6bb5\u8bbe\u7f6e"},{key:"three",value:"\u5206\u644a\u8bbe\u7f6e"}],pe=(ae=Object(L["c"])(function(e){var t=e.loading,a=e.session,n=e.addCategory,r=e.costGlobal;return{loading:t.effects["addCategory/add"]||t.effects["addCategory/edit"],userInfo:a.userInfo,details:n.details,allList:n.allList,checkDel:n.checkDel,expandLists:n.expandLists,fieldList:n.fieldList,isModifyInvoice:r.isModifyInvoice}}),ae((re=function(e){k()(a,e);var t=de(a);function a(){var e;y()(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),e.state={current:"one",data:{},selectList:[],shareField:B["n"],fieldList:[]},e.changeList=function(e){var t=[];return e.forEach(function(e){var a=h()({},e);if(3===e.fieldType){var n=f()(e.expandFieldVos);if(n.findIndex(function(e){return"detail_sale"===e.field})>-1){var r=n.findIndex(function(e){return"detail_sale"===e.field});n.splice(r,1)}if(n.findIndex(function(e){return"detail_account"===e.field})>-1){var i=n.findIndex(function(e){return"detail_account"===e.field});n.splice(i,1)}console.log("expand",n),a=h()({},a,{expandFieldVos:n})}t.push(a)}),t},e.findIndexArray=function(t,a,n){for(var r=Array.from(n),i=0,l=t.length;i<l;i+=1){if(r.push(t[i].id),t[i].id===a)return r;var s=t[i].children;if(s&&s.length){var c=e.findIndexArray(s,a,r);if(c)return c}r.pop()}return!1},e.compare=function(e){return function(t,a){var n=t[e],r=a[e];return n-r}},e.onHandle=function(t){if("one"!==t.key&&e.formRef&&e.formRef.getFormItems){var a={},n=e.formRef.getFormItems();if(!n)return;Object.assign(a,h()({},n,{status:n.status?1:0})),e.setState({data:n})}var r=e.state.selectList,i=f()(r);if(e.childRef&&e.childRef.getRightParams){var l=e.childRef.getRightParams();if(console.log("CategoryAdd -> onStep -> valStr",l),!l)return;var s=r.findIndex(function(e){return e.field===l.field});i.splice(s,1,l)}e.setState({current:t.key,selectList:i})},e.idGenerator=function(){var e=1e4,t="0123456789ABCDEFGHIGKLMNOPQRSTUVWXYZabcdefghigklmnopqrstuvwxyz",a=t.split(""),n=t.length,r=[];do{var i=e%n;e=(e-i)/n,r.push(a[i])}while(e);var l=Object(ce["s"])();return"self_".concat(r.join("")).concat(l+1)},e.onStep=function(t){var a=e.state,n=a.current,r=a.data,i=a.selectList,l=a.shareField,s=f()(i),c=e.props.match.params.id,o=c.split("_")[0],d=c.split("_")[1],u=e.props.userInfo,p=r;if("one"===n){var m=e.formRef.getFormItems();if(!m)return;Object.assign(p,h()({},m,{status:m.status?1:0}))}if(e.childRef&&e.childRef.getRightParams){var y=e.childRef.getRightParams();if(console.log("CategoryAdd -> onStep -> valStr",y),!y)return;var v=i.findIndex(function(e){return e.field===y.field});s.splice(v,1,y)}if(("three"===n||"add"!==o&&"child"!==o)&&"down"!==t){var g="edit"!==o?"addCategory/add":"addCategory/edit",I=s.map(function(e,t){return h()({},e,{isSelect:!0,sort:t+1,status:1})}),k=I.filter(function(e){return-1===e.field.indexOf("expand_field")&&-1===e.field.indexOf("self_")}),b=h()({id:"edit"!==o?"":d,showField:k.map(function(e){return h()({},e,{status:1})}),shareField:l.map(function(e){return h()({},e,{status:e.status?1:0})}),type:1},p,{companyId:u.companyId||"",parentId:p.parentId&&p.parentId[p.parentId.length-1]||"",status:p.status?1:0,expandField:I.filter(function(e){return e.field.indexOf("expand_field")>-1}),selfFields:I.filter(function(e){return e.field.indexOf("self_")>-1}),attribute:"add"===o?d:c.split("_")[2]});e.props.dispatch({type:g,payload:h()({},b)}).then(function(){e.props.history.push("/basicSetting/costCategory")})}else{var E=fe.findIndex(function(e){return e.key===n});e.setState({data:p,current:"up"===t?fe[E+1].key:fe[E-1].key})}},e.onChangeData=function(t,a){if(e.setState(d()({},t,a)),"selectList"===t){var n=e.state.fieldList,r=f()(n),i=r.map(function(e){return e.field})||[],l=[],s=a.map(function(e){return!i.includes(e.field)&&e.field.indexOf("expand_")>-1?(l.push(e),e.field):e.field});l.length&&(r=[].concat(f()(r),l)),e.setState({fieldList:r.map(function(e){return s.includes(e.field)?h()({},e,{isSelect:!0}):h()({},e,{isSelect:!1})})},function(){console.log(e.state.fieldList)})}},e.onCancel=function(){e.props.history.push("/basicSetting/costCategory")},e}return g()(a,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.id,a=t.split("_")[0],n=t.split("_")[1];this.props.dispatch({type:"costGlobal/queryModifyOrder",payload:{}}),this.props.dispatch({type:"addCategory/allList",payload:{attribute:"add"===a?n:t.split("_")[2]}}).then(function(){var t=e,r=e.props.allList,i=Object(F["a"])({rootId:0,pId:"parentId",tName:"costName",name:"costName",otherKeys:["icon","note","type"]},r),l=e.props.userInfo;if("add"!==a&&"child"!==a)e.props.dispatch({type:"addCategory/detail",payload:{id:n,companyId:l.companyId||""}}).then(function(){var n={},r=t.props.details,l=[].concat(f()(r.showField),f()(r.expandField),f()(r.selfFields))||[];n=h()({},r,{parentId:t.findIndexArray(i,r.parentId,[]),status:1===Number(r.status)}),"copy"===a&&Object.assign(n,{costName:"".concat(r.costName,"\u7684\u526f\u672c")}),t.setState({data:n,selectList:e.changeList(l.sort(e.compare("sort"))),shareField:r.shareField})});else if("child"===a){var s={parentId:e.findIndexArray(i,n,[])};t.setState({data:s})}}),this.props.dispatch({type:"addCategory/fieldList",payload:{categoryId:"add"!==a&&"child"!==a?n:""}}).then(function(){var t=e.props.fieldList,n=t.filter(function(e){return e.isSelect});"add"!==a&&"child"!==a||e.setState({selectList:e.changeList(n)}),e.setState({fieldList:e.changeList(t)})})}},{key:"render",value:function(){var e=this,t=this.props,a=t.allList,n=t.isModifyInvoice,r=this.props.match.params.id,i=r.split("_")[0],o=this.state,d=o.current,u=o.shareField,f=o.selectList,p=o.fieldList,h=o.data,m=[{path:"/basicSetting/costCategory",breadcrumbName:"\u652f\u51fa\u7c7b\u522b\u8bbe\u7f6e"},{path:"second",breadcrumbName:"".concat("edit"!==i?"\u65b0\u5efa":"\u7f16\u8f91","\u652f\u51fa\u7c7b\u522b")}];return S.a.createElement("div",{style:{height:"100%"}},S.a.createElement("div",{style:{width:"100%"}},S.a.createElement(D["a"],{title:S.a.createElement(c["a"],{title:null,breadcrumb:{routes:m},style:{background:"#fff"}})}),S.a.createElement("div",{style:{background:"#fff",width:"100%"}},S.a.createElement(s["a"],{mode:"horizontal",className:"m-l-32 titleMenu",selectedKeys:[d],onClick:function(t){return e.onHandle(t)}},fe.map(function(e,t){return S.a.createElement(s["a"].Item,{key:e.key},S.a.createElement("span",{className:e.key===d?w()("circle","active"):"circle"},t+1),S.a.createElement("span",null,e.value))})))),"three"!==d&&S.a.createElement("div",{style:{position:"relative",height:"calc(100% - 153px)",overflow:"scroll",width:"100%"}},"one"===d&&S.a.createElement("div",{className:"content-dt",style:{height:"100%",minWidth:"1008px",width:"inherit"}},S.a.createElement(j["a"],{title:"\u57fa\u7840\u8bbe\u7f6e"}),S.a.createElement(X,{wrappedComponentRef:function(t){e.formRef=t},list:a,data:h,title:i})),"two"===d&&S.a.createElement("div",{style:{height:"100%",padding:"24px 24px 0 24px",display:"flex",position:"absolute",minWidth:"1008px",width:"inherit"}},S.a.createElement(oe["a"],{fieldList:p,selectList:f,onChangeData:this.onChangeData,isModifyInvoice:n,operateType:i,middleRef:function(t){e.childRef=t},selectId:"costCategory",type:"cost"}))),"three"===d&&S.a.createElement("div",{className:"content-dt",style:{height:"calc(100% - 178px)"}},S.a.createElement(j["a"],{title:"\u57fa\u7840\u8bbe\u7f6e"}),S.a.createElement(se,{shareField:u,onChangeData:this.onChangeData})),S.a.createElement(O["a"],{right:S.a.createElement(S.a.Fragment,null,S.a.createElement(l["a"],{type:"default",className:"m-r-8",onClick:function(){return e.onCancel()}},"\u53d6\u6d88"),"one"!==d&&S.a.createElement(l["a"],{type:"default",className:"m-r-8",onClick:function(){return e.onStep("down")}},"\u4e0a\u4e00\u6b65"),S.a.createElement(l["a"],{type:"primary",onClick:function(){return e.onStep("up")}},"three"===d||"add"!==i&&"child"!==i?"\u4fdd\u5b58":"\u4e0b\u4e00\u6b65"))}))}}]),a}(R["PureComponent"]),ne=re))||ne);t["default"]=pe}}]);