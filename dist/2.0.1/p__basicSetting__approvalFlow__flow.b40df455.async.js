(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[10],{azhH:function(e,t,a){"use strict";a.r(t);a("OaEy");var n,o,r,s,i=a("2fM7"),c=(a("+L6B"),a("2/Rp")),l=a("d6i3"),p=a.n(l),u=a("1l/V"),d=a.n(u),h=(a("miYZ"),a("tsqr")),f=a("2Taf"),m=a.n(f),v=a("vZ4D"),y=a.n(v),g=a("MhPg"),k=a.n(g),E=a("l4Ni"),P=a.n(E),C=a("ujKo"),M=a.n(C),N=a("q1tI"),b=a.n(N),w=a("TSYQ"),R=a.n(w),S=a("RVIS"),D=a("ydnR"),F=a("/MKj"),q=a("tuXM"),L=a.n(q),x=a("hiCr"),O=(a("2qtc"),a("kLXV")),_=a("jehZ"),Q=a.n(_),j=(a("5NDa"),a("5rEg")),V=a("p0pE"),H=a.n(V),I=(a("y8nQ"),a("Vl3Y"));function J(e){var t=Y();return function(){var a,n=M()(e);if(t){var o=M()(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return P()(this,a)}}function Y(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var Z,z,K,T={costName:"\u540d\u79f0",parentId:"\u6240\u5c5e\u5206\u7ec4"},X=(n=I["a"].create(),o=Object(F["c"])(function(e){var t=e.loading;return{loading:t.effects["approvalFlow/edit"]||!1}}),n(r=o((s=function(e){k()(a,e);var t=J(a);function a(e){var n;return m()(this,a),n=t.call(this,e),n.onShow=function(){var e=n.props,t=e.uniqueMark,a=e.approvePersonList,o="";a.forEach(function(e){e.uniqueMark===t&&(o=e.templateName)}),n.setState({name:o,visible:!0})},n.handleOk=function(){var e=n.props,t=e.form,a=e.onOk,o=e.dispatch,r=e.uniqueMark;t.validateFieldsAndScroll(function(e,t){if(!e){var s=H()({},t,{uniqueMark:r}),i="approvalFlow/edit";o({type:i,payload:s}).then(function(){h["a"].success("\u4fee\u6539\u540d\u79f0\u6210\u529f"),a(),n.onRest(),n.onCancel()})}})},n.onCancel=function(){n.onRest(),n.setState({visible:!1})},n.onRest=function(){n.props.form.resetFields()},n.state={visible:!1,name:""},n}return y()(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.children,n=t.loading,o=t.form.getFieldDecorator,r=this.state.name,s=this.state.visible;return b.a.createElement("span",null,b.a.createElement("span",{onClick:function(){return e.onShow()}},a),b.a.createElement(O["a"],{title:"\u5ba1\u6279\u6d41\u8bbe\u7f6e",visible:s,onCancel:function(){return e.setState({visible:!1})},maskClosable:!1,footer:[b.a.createElement(c["a"],{key:"cancel",onClick:this.onCancel},"\u53d6\u6d88"),b.a.createElement(c["a"],{key:"save",type:"primary",onClick:this.handleOk,loading:n},"\u4fdd\u5b58")]},b.a.createElement(I["a"],Q()({layout:"inline"},D["x"]),b.a.createElement(I["a"].Item,{key:"name",label:T.costName},o("name",{initialValue:r||"",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u540d\u79f0"},{max:16,message:"\u6700\u591a\u53ea\u80fd\u8f93\u516520\u5b57"}]})(b.a.createElement(j["a"],{placeholder:"\u8bf7\u8f93\u5165\u540d\u79f0",style:{width:"280px"}}))))))}}]),a}(b.a.PureComponent),r=s))||r)||r),A=X;function B(e){var t=W();return function(){var a,n=M()(e);if(t){var o=M()(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return P()(this,a)}}function W(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var G=(Z=Object(F["c"])(function(e){var t=e.approvalFlow,a=e.global;return{nodes:t.nodes,detailNode:t.detailNode,approvePersonList:a.approvePersonList}}),Z((K=function(e){k()(a,e);var t=B(a);function a(e){var n;return m()(this,a),n=t.call(this,e),n.onHandle=function(e){n.setState({status:e}),n.props.dispatch({type:"approvalFlow/list",payload:{uniqueMark:e,deepQueryFlag:!1}}).then(function(){var e=n.props,t=e.nodes,a=e.detailNode;n.setState({nodes:t,ccPosition:a.ccPosition,repeatMethods:a.repeatMethod})})},n.onQuery=function(e){n.props.dispatch({type:"approvalFlow/list",payload:e}).then(function(){var e=n.props,t=e.nodes,a=e.detailNode;n.setState({nodes:t,ccPosition:a.ccPosition,repeatMethods:a.repeatMethod})})},n.onChange=function(e){n.setState({nodes:e})},n.onStartChange=function(e){console.log(e)},n.save=function(){console.log(n.processData&&n.processData.getData());var e=n.state,t=e.status,a=e.repeatMethods,o=e.ccPosition,r=n.processData.getData();Promise.all([r]).then(function(e){n.props.dispatch({type:"approvalFlow/add",payload:{node:e[0].formData,uniqueMark:t,repeatMethod:a,ccPosition:o,deepQueryFlag:!1}}).then(function(){n.onQuery({uniqueMark:t}),h["a"].success("\u4fdd\u5b58\u6210\u529f")})}).catch(function(e){console.log(e)})},n.onChangRepeat=function(e){n.setState({repeatMethods:e})},n.onChangePosition=function(e){n.setState({ccPosition:e})},n.handleOk=function(){n.props.dispatch({type:"global/approverPersonList",payload:{}})},n.state={nodes:{},status:"CreatorFirstLeader",repeatMethods:"NONE",ccPosition:""},n}return y()(a,[{key:"componentDidMount",value:function(){var e=d()(p.a.mark(function e(){var t=this;return p.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.props.dispatch({type:"global/costList",payload:{}}),this.props.dispatch({type:"global/projectList",payload:{}}),this.props.dispatch({type:"global/supplierList",payload:{}}),this.props.dispatch({type:"global/approverRole",payload:{pageNo:1,pageSize:1e3}}),e.next=6,this.props.dispatch({type:"global/approverPersonList",payload:{}});case 6:return e.next=8,this.props.dispatch({type:"approvalFlow/list",payload:{uniqueMark:"CreatorFirstLeader",deepQueryFlag:!1}}).then(function(){var e=t.props,a=e.nodes,n=e.detailNode;t.setState({nodes:a,ccPosition:n.ccPosition,repeatMethods:n.repeatMethod})});case 8:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"render",value:function(){var e=this,t=this.state,a=t.status,n=t.repeatMethods,o=t.nodes,r=t.ccPosition,s=this.props.approvePersonList;return b.a.createElement("div",{style:{height:"100%"}},b.a.createElement("div",{className:"app_header"},b.a.createElement("p",{className:"app_header_title"},"\u5ba1\u6279\u8bbe\u7f6e"),b.a.createElement("p",{className:"app_header_line"},"\u9ed8\u8ba4\u4e3a\u4f60\u63d0\u4f9b5\u79cd\u7c7b\u578b\u7684\u5ba1\u6279\u6d41\u7a0b\uff0c\u4f60\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\u8bbe\u7f6e\u5ba1\u6279\u4eba")),b.a.createElement("div",{className:R()("content-dt",L.a.approval_cnt),style:{height:"auto"}},b.a.createElement(S["a"],{lists:s||[],onHandle:function(t){return e.onHandle(t)},params:{key:"uniqueMark",value:"templateName"},status:a}),b.a.createElement("div",{className:L.a.nodeCnt},b.a.createElement("div",{className:L.a.method_box},b.a.createElement(A,{approvePersonList:s,uniqueMark:a,onOk:this.handleOk},b.a.createElement(c["a"],{type:"primary",className:"m-b-8"},"\u5ba1\u6279\u6d41\u8bbe\u7f6e")),b.a.createElement("p",null,"\u5ba1\u6279\u53bb\u91cd"),b.a.createElement(i["a"],{value:n,style:{minWidth:"300px"},onChange:function(t){return e.onChangRepeat(t)},getPopupContainer:function(e){return e.parentNode}},D["J"].map(function(e){return b.a.createElement(i["a"].Option,{key:e.key},e.value)}))),b.a.createElement("div",{className:L.a.approval_process,key:a},b.a.createElement(x["a"],{conf:o,tabName:"processDesign",startNodeChange:this.onChange,ref:function(t){e.processData=t},onChangePosition:this.onChangePosition,ccPosition:r}),b.a.createElement("p",{className:L.a.save_box},b.a.createElement(c["a"],{type:"primary",onClick:function(){return e.save()}},"\u4fdd\u5b58"))))))}}]),a}(N["Component"]),z=K))||z);t["default"]=G}}]);